class FormKeeper{constructor(f,s){'use strict';if(!f){return console.error('Para ejecutar FormKeeper adecuadamente, debe indicar en el primer parámetro la información nesesaria para poder trabajar. Para más información, consulte la documentación en: https://github.com/EdGraVill/formKeeper');}if(typeof s!=='boolean'&&s!==undefined){console.warn('El segundo parámetro sólo admite un valor de tipo boleando (true / false), esto para indicar si desea que FormKeeper mantenga encriptada la información que guarda. Por defecto, el sistema de encriptación está activado');}const fkDefault={domEl:'',domEls:[],ignorarDomEls:[],ignorarTipos:['submit','reset','button','file','image'],elementos:['INPUT','SELECT','TEXTAREA','DATALIST'],ignorarElementos:[],encriptado:s===undefined||typeof s!=='boolean'?true:s,restaurarDefault:false,restaurarCallback:()=>{console.log('Elementos restaurados con éxito.')}};if(typeof f.encriptado!=='undefined'&&typeof f.encriptado!=='boolean'){console.warn('La opción "encriptado" sólo admite un valor de tipo boleando (true / false), esto para indicar si desea que FormKeeper mantenga encriptada la información que guarda. Por defecto, el sistema de encriptación está activado')}if(typeof f==='object'&&f instanceof Array===false){f.encriptado=typeof f.encriptado!=='undefined'&&typeof f.encriptado!=='boolean'?true:f.encriptado;}const fk=f instanceof Array?fkDefault:typeof f!=='object'?fkDefault:Object.assign(fkDefault,f);for(let i=0;i<fk.ignorarDomEls.length;i+=1){fk.ignorarDomEls[i]=fk.ignorarDomEls[i]instanceof window.HTMLElement?fk.ignorarDomEls[i]:document.getElementById(fk.ignorarDomEls[i])}fk.domEl=f instanceof window.HTMLElement?f:typeof f==='string'?document.getElementById(f):f instanceof Array?f:typeof f==='object'?typeof f.domEl==='string'?document.getElementById(f.domEl):f.domEl:null;if(fk.domEl===null||fk.domEl===undefined){return console.error('Ha ocurrido un error al intentar interpretar la información del DOM Element con el que se iba a trabajar.');}if(fk.domEl instanceof Array){for(let i=0;i<fk.domEl.length;i+=1){fk.domEls[i]=fk.domEl[i]instanceof window.HTMLElement?fk.domEl[i]:document.getElementById(fk.domEl[i])}fk.domEl='array'}else if(fk.domEl.childNodes.length===0){fk.domEls=[fk.domEl];fk.domEl='individual'}else if(fk.domEl.childNodes.length>0){const hijos=fk.domEl.childNodes;for(let i=0;i<hijos.length;i+=1){if(fk.elementos.indexOf(hijos[i].tagName)>=0&&fk.ignorarElementos.indexOf(hijos[i].tagName)===-1&&fk.ignorarTipos.indexOf(hijos[i].type)===-1&&fk.ignorarDomEls.indexOf(hijos[i])===-1){fk.domEls.push(hijos[i])}}}else{return console.error('Ha ocurrido un error al intentar interpretar la información del DOM Element con el que se iba a trabajar.')}fk.identificador=typeof fk.domEl==='string'?this.getPathTo(fk.domEls[0]):this.getPathTo(fk.domEl);const objRds={};for(let i=0;i<fk.domEls.length;i+=1){const thisDomEl=fk.domEls[i];if(thisDomEl.type==='radio'){if(!objRds[thisDomEl.name]){objRds[thisDomEl.name]=[]}objRds[thisDomEl.name].push(thisDomEl)}}for(let i=0;i<fk.domEls.length;i+=1){const thisDomEl=fk.domEls[i];if(thisDomEl.type==='radio'){const thsNm=thisDomEl.name;fk.domEls[i]=objRds[thsNm];fk.domEls.splice(i+1,objRds[thsNm].length-1)}}for(let i=0;i<fk.domEls.length;i+=1){const thisDomEl=fk.domEls[i];if(thisDomEl.tagName==='INPUT'||thisDomEl.tagName==='TEXTAREA'){if(thisDomEl.type==='checkbox'){thisDomEl.setAttribute('onchange',`FormKeeper.saveValue(${ i }, this.checked, '${fk.identificador }', ${fk.encriptado })`)}else if(thisDomEl.type==='range'||thisDomEl.type==='color'){thisDomEl.setAttribute('onchange',`FormKeeper.saveValue(${ i }, this.value, '${fk.identificador }', ${fk.encriptado })`)}else if(thisDomEl.type==='text'||thisDomEl.type==='password'||thisDomEl.type==='email'||thisDomEl.type==='search'||thisDomEl.type==='url'||thisDomEl.tagName==='TEXTAREA'){thisDomEl.setAttribute('onkeyup',`FormKeeper.saveValue(${ i }, this.value, '${fk.identificador }', ${fk.encriptado })`)}else{thisDomEl.setAttribute('onkeyup',`FormKeeper.saveValue(${ i }, this.value, '${fk.identificador }', ${fk.encriptado })`);thisDomEl.setAttribute('onchange',`FormKeeper.saveValue(${ i }, this.value, '${fk.identificador }', ${fk.encriptado })`)}}else if(thisDomEl instanceof Array){for(let j=0;j<thisDomEl.length;j+=1){thisDomEl[j].setAttribute('onchange',`FormKeeper.saveRadio(${ i }, this.checked, '${fk.identificador }', ${fk.encriptado }, [${thisDomEl.length },${ j }])`)}}else{thisDomEl.setAttribute('onchange',`FormKeeper.saveValue(${ i }, this.value, '${fk.identificador }', ${fk.encriptado })`)}}this.estructura=fk;if(fk.restaurarDefault){this.restaurar()}}getPathTo(element){if(element.id!==''){return `id("${element.id }")`}if(element===document.body){return element.tagName}let ix=0;let siblings=element.parentNode.childNodes;for(let i=0;i<siblings.length;i+=1){var sibling=siblings[i];if(sibling===element){return `${this.getPathTo(element.parentNode)}/${element.tagName }[${ix+1}]`}if(sibling.nodeType===1&&sibling.tagName===element.tagName){ix++}}}static saveValue(index,domElValue,identificador,encriptado){if(encriptado){const bjtFormKeeper=window.localStorage.getItem('FormKeeper')!==null?JSON.parse(this.prototype.decode(window.localStorage.getItem('FormKeeper'))):{};bjtFormKeeper[identificador]=bjtFormKeeper[identificador]?bjtFormKeeper[identificador]:[];bjtFormKeeper[identificador][index]=domElValue;const readyToSend=this.prototype.encode(JSON.stringify(bjtFormKeeper));window.localStorage.setItem('FormKeeper',readyToSend)}else{window.localStorage.setItem(`${identificador+index }`,domElValue)}}static saveRadio(index,domElValue,identificador,encriptado,info){if(encriptado){const bjtFormKeeper=window.localStorage.getItem('FormKeeper')!==null?JSON.parse(this.prototype.decode(window.localStorage.getItem('FormKeeper'))):{};bjtFormKeeper[identificador]=bjtFormKeeper[identificador]?bjtFormKeeper[identificador]:[];bjtFormKeeper[identificador][index]=bjtFormKeeper[identificador][index]?bjtFormKeeper[identificador][index]:[];for(let i=0;i<info[0];i+=1){bjtFormKeeper[identificador][index][i]=false}bjtFormKeeper[identificador][index][info[1]]=domElValue;const readyToSend=this.prototype.encode(JSON.stringify(bjtFormKeeper));window.localStorage.setItem('FormKeeper',readyToSend)}else{const radio=window.localStorage.getItem(`${identificador+index }`)!==null?window.localStorage.getItem(`${identificador+index }`).split(','):[];for(let i=0;i<info[0];i+=1){radio[i]=false}radio[info[1]]=domElValue;window.localStorage.setItem(`${identificador+index }`,radio)}}restaurar(cb){const promesa=new Promise((resolve,reject)=>{if(this.estructura.encriptado){const bjtFormKeeper=window.localStorage.getItem('FormKeeper')!==null?JSON.parse(this.decode(window.localStorage.getItem('FormKeeper'))):null;if(bjtFormKeeper===null){reject('No hay elementos que restaurar en este momento.')}for(let i=0;i<this.estructura.domEls.length;i+=1){const thisDomEl=this.estructura.domEls[i];if(thisDomEl instanceof Array&&bjtFormKeeper[this.estructura.identificador][i]!==undefined&&bjtFormKeeper[this.estructura.identificador][i]!==null){for(let j=0;j<thisDomEl.length;j+=1){if(bjtFormKeeper[this.estructura.identificador][i][j]===true){thisDomEl[j].checked=true}}}else if(thisDomEl.type==='checkbox'){thisDomEl.checked=bjtFormKeeper[this.estructura.identificador][i]?bjtFormKeeper[this.estructura.identificador][i]:false}else{thisDomEl.value=bjtFormKeeper[this.estructura.identificador][i]?bjtFormKeeper[this.estructura.identificador][i]:''}}}else{const lCmbs=[];for(let item in window.localStorage){if(item.includes(this.estructura.identificador)){lCmbs[item.replace(this.estructura.identificador,'')]=window.localStorage.getItem(item).includes(',')?window.localStorage.getItem(item).split(','):window.localStorage.getItem(item)}}if(lCmbs.length===0){reject('No hay elementos que restaurar en este momento.')}for(let i=0;i<this.estructura.domEls.length;i+=1){const thisDomEl=this.estructura.domEls[i];if(thisDomEl instanceof Array){for(let j=0;j<thisDomEl.length;j+=1){if(lCmbs[i][j]==='true'){thisDomEl[j].checked=true}}}else if(thisDomEl.type==='checkbox'){thisDomEl.checked=lCmbs[i]?lCmbs[i]:false}else{thisDomEl.value=lCmbs[i]?lCmbs[i]:''}}}resolve(this.estructura.restaurarCallback)});promesa.then((callback)=>{if(cb!==undefined&&this.isFunction(cb)){cb.call()}if(cb===undefined){callback.call()}},(error)=>{console.warn(error)})}_keyStr(){return 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='}encode(e){let t='';let n,r,i,s,o,u,a;let f=0;e=this.utf8Encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr().charAt(s)+this._keyStr().charAt(o)+this._keyStr().charAt(u)+this._keyStr().charAt(a)}return t}decode(e){let t='';let n,r,i;let s,o,u,a;let f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,'');while(f<e.length){s=this._keyStr().indexOf(e.charAt(f++));o=this._keyStr().indexOf(e.charAt(f++));u=this._keyStr().indexOf(e.charAt(f++));a=this._keyStr().indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!==64){t=t+String.fromCharCode(r)}if(a!==64){t=t+String.fromCharCode(i)}}t=this.utf8Decode(t);return t}utf8Encode(e){e=e.replace(/rn/g,'n');let t='';for(let n=0;n<e.length;n+=1){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t}utf8Decode(e){let t='';let n=0;let r=0;let c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n+=1}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);let c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}isFunction(functionToCheck){const getType={};return functionToCheck&&getType.toString.call(functionToCheck)==='[object Function]'}}